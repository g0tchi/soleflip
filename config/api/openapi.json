{
  "openapi": "3.1.0",
  "info": {
    "title": "SoleFlipper API",
    "description": "\n# SoleFlipper API Documentation\n\n## Overview\nProfessional sneaker reselling management system with inventory tracking, \nautomated imports, and analytics integration.\n\n## Architecture\n- **FastAPI**: Modern async Python framework\n- **PostgreSQL**: Primary database with schema separation\n- **n8n Integration**: Webhook-based automation\n- **Metabase**: Analytics and reporting\n- **Domain-Driven Design**: Clean architecture patterns\n\n## Authentication\nCurrently, most endpoints are open. Authentication will be added in future versions.\n\n## Rate Limiting\nRate limiting is planned but not yet implemented.\n\n## Data Import Sources\n- **StockX**: Sales and transaction data\n- **Notion**: Inventory management database\n- **Manual**: CSV/Excel file uploads with auto-detection\n\n## Error Handling\nAll endpoints return structured error responses with:\n- `error.type`: Error category\n- `error.message`: Human-readable description\n- `error.details`: Additional context (optional)\n\n## Pagination\nList endpoints support query parameters:\n- `limit`: Number of items (default: 50, max: 1000)\n- `offset`: Number of items to skip (default: 0)\n        ",
    "version": "2.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:8000",
      "description": "Development server"
    },
    {
      "url": "https://api.soleflip.com",
      "description": "Production server"
    }
  ],
  "paths": {
    "/api/v1/integration/stockx/import-orders": {
      "post": {
        "tags": [
          "Integration",
          "StockX Integration",
          "Import"
        ],
        "summary": "Stockx Import Orders Webhook",
        "description": "Triggers a background task to import historical orders from the StockX API\nfor a given date range.",
        "operationId": "stockx_import_orders_webhook_api_v1_integration_stockx_import_orders_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StockXImportRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StockXImportResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/orders/stockx-history": {
      "get": {
        "tags": [
          "Orders",
          "StockX Integration"
        ],
        "summary": "Get Historical Orders from StockX",
        "description": "Fetches a paginated list of historical orders from the StockX API, with optional filters.",
        "operationId": "get_historical_orders_api_v1_orders_stockx_history_get",
        "parameters": [
          {
            "name": "fromDate",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "toDate",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "orderStatus",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "productId",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "variantId",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object"
                  },
                  "title": "Historical Orders"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/integration/import-status/{batch_id}": {
      "get": {
        "tags": [
          "Integration",
          "Import"
        ],
        "summary": "Get Import Status",
        "description": "Retrieves the current status of an import batch.",
        "operationId": "get_import_status_api_v1_integration_import_status__batch_id__get",
        "parameters": [
          {
            "name": "batch_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "title": "Batch Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImportStatusResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/orders/active": {
      "get": {
        "tags": [
          "Orders"
        ],
        "summary": "Get Active Orders",
        "description": "Get all active orders from the StockX marketplace.\n\nAn order is considered active from the time it was created to the time the product\nwas received and authenticated by StockX and the seller is paid out.",
        "operationId": "get_active_orders_api_v1_orders_active_get",
        "parameters": [
          {
            "name": "orderStatus",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by order status.",
              "title": "Orderstatus"
            },
            "description": "Filter by order status."
          },
          {
            "name": "productId",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by product ID.",
              "title": "Productid"
            },
            "description": "Filter by product ID."
          },
          {
            "name": "variantId",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by variant ID.",
              "title": "Variantid"
            },
            "description": "Filter by variant ID."
          },
          {
            "name": "sortOrder",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Sort order for the results.",
              "default": "CREATEDAT",
              "title": "Sortorder"
            },
            "description": "Sort order for the results."
          },
          {
            "name": "inventoryTypes",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Comma-separated list of inventory types.",
              "title": "Inventorytypes"
            },
            "description": "Comma-separated list of inventory types."
          },
          {
            "name": "initiatedShipmentDisplayIds",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by shipment display IDs.",
              "title": "Initiatedshipmentdisplayids"
            },
            "description": "Filter by shipment display IDs."
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": true
                  },
                  "title": "Response Get Active Orders Api V1 Orders Active Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "Root",
        "operationId": "root__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/APIInfo"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/products/{product_id}/sync-variants-from-stockx": {
      "post": {
        "tags": [
          "Products",
          "StockX Integration"
        ],
        "summary": "Sync Product Variants from StockX",
        "description": "Triggers a background task to sync all product variants from StockX, creating or updating inventory items.",
        "operationId": "sync_product_variants_api_v1_products__product_id__sync_variants_from_stockx_post",
        "parameters": [
          {
            "name": "product_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "title": "Product Id"
            }
          }
        ],
        "responses": {
          "202": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/products/{product_id}/stockx-details": {
      "get": {
        "tags": [
          "Products",
          "StockX Integration"
        ],
        "summary": "Get Product Details from StockX",
        "description": "Fetches real-time product details for a given product ID directly from the StockX Catalog API.",
        "operationId": "get_stockx_product_details_api_v1_products__product_id__stockx_details_get",
        "parameters": [
          {
            "name": "product_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Product Id"
            },
            "description": "The StockX Product ID (UUID or slug)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "title": "StockX Product Details"
                }
              }
            }
          },
          "404": {
            "description": "Product not found on StockX",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/products/search-stockx": {
      "get": {
        "tags": [
          "Products",
          "StockX Integration"
        ],
        "summary": "Search for Products on StockX",
        "description": "Performs a search against the StockX Catalog API using a query string, GTIN, or Style ID.",
        "operationId": "search_stockx_products_api_v1_products_search_stockx_get",
        "parameters": [
          {
            "name": "query",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1,
              "maxLength": 100
            },
            "description": "Keyword, GTIN, or Style ID to search for."
          },
          {
            "name": "pageNumber",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1,
              "minimum": 1
            },
            "description": "Requested page number."
          },
          {
            "name": "pageSize",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10,
              "minimum": 1,
              "maximum": 50
            },
            "description": "Number of products to return per page."
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "title": "StockX Search Results"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/products/{product_id}/stockx-market-data": {
      "get": {
        "tags": [
          "Products",
          "StockX Integration"
        ],
        "summary": "Get Market Data from StockX",
        "description": "Fetches real-time market data (highest bid, lowest ask) for all variants of a product from the StockX API.",
        "operationId": "get_stockx_market_data_api_v1_products__product_id__stockx_market_data_get",
        "parameters": [
          {
            "name": "product_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The StockX Product ID"
          },
          {
            "name": "currencyCode",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "ISO 4217 currency code to get the market data in."
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object"
                  },
                  "title": "StockX Market Data"
                }
              }
            }
          },
          "404": {
            "description": "Product not found on StockX",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "APIInfo": {
        "properties": {
          "name": {
            "type": "string",
            "title": "Name"
          },
          "version": {
            "type": "string",
            "title": "Version"
          }
        },
        "type": "object",
        "required": [
          "name",
          "version"
        ],
        "title": "APIInfo"
      },
      "Body_upload_stockx_file_api_v1_integration_webhooks_stockx_upload_post": {
        "properties": {
          "file": {
            "type": "string",
            "format": "binary",
            "title": "File"
          },
          "validate_only": {
            "type": "boolean",
            "title": "Validate Only",
            "default": false
          },
          "batch_size": {
            "type": "integer",
            "title": "Batch Size",
            "default": 1000
          }
        },
        "type": "object",
        "required": [
          "file"
        ],
        "title": "Body_upload_stockx_file_api_v1_integration_webhooks_stockx_upload_post"
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "ImportStatusResponse": {
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "title": "Id"
          },
          "source_type": {
            "type": "string",
            "title": "Source Type"
          },
          "source_file": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source File"
          },
          "total_records": {
            "type": "integer",
            "title": "Total Records"
          },
          "processed_records": {
            "type": "integer",
            "title": "Processed Records"
          },
          "error_records": {
            "type": "integer",
            "title": "Error Records"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At"
          },
          "completed_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Completed At"
          }
        },
        "type": "object",
        "required": [
          "id",
          "source_type",
          "source_file",
          "total_records",
          "processed_records",
          "error_records",
          "status",
          "created_at"
        ],
        "title": "ImportStatusResponse"
      },
      "StockXImportRequest": {
        "properties": {
          "from_date": {
            "type": "string",
            "format": "date",
            "title": "From Date"
          },
          "to_date": {
            "type": "string",
            "format": "date",
            "title": "To Date"
          }
        },
        "type": "object",
        "required": [
          "from_date",
          "to_date"
        ],
        "title": "StockXImportRequest"
      },
      "StockXImportResponse": {
        "properties": {
          "status": {
            "type": "string",
            "title": "Status",
            "default": "processing_started"
          },
          "message": {
            "type": "string",
            "title": "Message",
            "default": "Import has been successfully queued."
          },
          "batch_id": {
            "type": "string",
            "format": "uuid",
            "title": "Batch Id"
          }
        },
        "type": "object",
        "required": [
          "batch_id"
        ],
        "title": "StockXImportResponse"
      },
      "UploadResponse": {
        "properties": {
          "filename": {
            "type": "string",
            "title": "Filename"
          },
          "total_records": {
            "type": "integer",
            "title": "Total Records"
          },
          "validation_errors": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Validation Errors"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "message": {
            "type": "string",
            "title": "Message"
          },
          "imported": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Imported"
          },
          "batch_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Batch Id"
          }
        },
        "type": "object",
        "required": [
          "filename",
          "total_records",
          "validation_errors",
          "status",
          "message"
        ],
        "title": "UploadResponse"
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      },
      "ImportStatus": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "processing_started",
              "validated",
              "completed",
              "failed"
            ],
            "description": "Current status of the import operation"
          },
          "batch_id": {
            "type": "string",
            "format": "uuid",
            "description": "Unique identifier for the import batch"
          },
          "message": {
            "type": "string",
            "description": "Human-readable status message"
          },
          "filename": {
            "type": "string",
            "description": "Original filename of uploaded file"
          },
          "record_count": {
            "type": "integer",
            "description": "Number of records processed"
          },
          "check_status_url": {
            "type": "string",
            "format": "uri",
            "description": "URL to check import progress"
          }
        },
        "required": [
          "status",
          "message"
        ]
      },
      "ValidationResult": {
        "type": "object",
        "properties": {
          "valid": {
            "type": "boolean",
            "description": "Whether validation passed"
          },
          "errors": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of validation errors"
          },
          "warnings": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of validation warnings"
          },
          "record_count": {
            "type": "integer",
            "description": "Total number of records validated"
          }
        }
      },
      "ImportBatchSummary": {
        "type": "object",
        "properties": {
          "summary": {
            "type": "object",
            "properties": {
              "total_batches": {
                "type": "integer"
              },
              "completed": {
                "type": "integer"
              },
              "failed": {
                "type": "integer"
              },
              "processing": {
                "type": "integer"
              },
              "success_rate": {
                "type": "number",
                "format": "float"
              }
            }
          },
          "recent_imports": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "format": "uuid"
                },
                "source_type": {
                  "type": "string"
                },
                "source_file": {
                  "type": "string"
                },
                "status": {
                  "type": "string"
                },
                "created_at": {
                  "type": "string",
                  "format": "date-time"
                },
                "total_records": {
                  "type": "integer"
                },
                "processed_records": {
                  "type": "integer"
                }
              }
            }
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "description": "Error category"
              },
              "message": {
                "type": "string",
                "description": "Human-readable error message"
              },
              "details": {
                "type": "object",
                "description": "Additional error context"
              }
            },
            "required": [
              "type",
              "message"
            ]
          }
        },
        "required": [
          "error"
        ]
      }
    }
  }
}
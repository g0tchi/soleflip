{
  "openapi": "3.0.2",
  "info": {
    "title": "SoleFlipper API",
    "version": "2.0.0",
    "description": "# SoleFlipper API Documentation\n\n## Overview\nProfessional sneaker reselling management system with inventory tracking, automated imports, and analytics integration.\n\n## Architecture\n- **FastAPI**: Modern async Python framework\n- **PostgreSQL**: Primary database with schema separation\n- **n8n Integration**: Webhook-based automation\n- **Metabase**: Analytics and reporting\n- **Domain-Driven Design**: Clean architecture patterns\n\n## Authentication\nCurrently, most endpoints are open. Authentication will be added in future versions.\n\n## Rate Limiting\nRate limiting is planned but not yet implemented.\n\n## Data Import Sources\n- **StockX**: Sales and transaction data\n- **Notion**: Inventory management database\n- **Manual**: CSV/Excel file uploads with auto-detection\n\n## Error Handling\nAll endpoints return structured error responses with:\n- `error.type`: Error category\n- `error.message`: Human-readable description\n- `error.details`: Additional context (optional)\n\n## Pagination\nList endpoints support query parameters:\n- `limit`: Number of items (default: 50, max: 1000)\n- `offset`: Number of items to skip (default: 0)"
  },
  "servers": [
    {
      "url": "http://localhost:8000",
      "description": "Development server"
    },
    {
      "url": "https://api.soleflip.com",
      "description": "Production server"
    }
  ],
  "paths": {
    "/api/v1/integration/stockx/import-orders": {
      "post": {
        "tags": [
          "StockX Integration"
        ],
        "summary": "Import StockX orders via API",
        "description": "Triggers a background task to fetch historical orders directly from the StockX API for a given date range. This is the recommended way for automated, scheduled imports.",
        "operationId": "stockx_import_orders_webhook",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "from_date": {
                    "type": "string",
                    "format": "date",
                    "description": "Start date for the order import (YYYY-MM-DD)."
                  },
                  "to_date": {
                    "type": "string",
                    "format": "date",
                    "description": "End date for the order import (YYYY-MM-DD)."
                  }
                },
                "required": [
                  "from_date",
                  "to_date"
                ]
              },
              "example": {
                "from_date": "2023-01-01",
                "to_date": "2023-01-31"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Accepted. The import process has been started in the background.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "processing_started"
                    },
                    "message": {
                      "type": "string"
                    },
                    "details": {
                      "type": "object",
                      "properties": {
                        "from_date": {
                          "type": "string",
                          "format": "date"
                        },
                        "to_date": {
                          "type": "string",
                          "format": "date"
                        },
                        "check_status_url": {
                          "type": "string",
                          "format": "uri"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation Error. The request body is invalid.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/integration/webhooks/stockx/upload": {
      "post": {
        "tags": [
          "StockX Integration"
        ],
        "summary": "Upload StockX CSV file (Legacy)",
        "description": "Upload StockX sales data CSV file for processing. Supports validation-only mode and batch processing.",
        "operationId": "stockx_upload_webhook",
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "CSV file containing StockX sales data"
                  },
                  "batch_size": {
                    "type": "integer",
                    "default": 1000,
                    "minimum": 1,
                    "maximum": 10000,
                    "description": "Number of records to process in each batch"
                  },
                  "validate_only": {
                    "type": "boolean",
                    "default": false,
                    "description": "If true, only validates the file without importing"
                  }
                },
                "required": ["file"]
              },
              "example": {
                "file": "stockx_sales_report.csv",
                "batch_size": 1000,
                "validate_only": false
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File uploaded successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImportStatus"
                },
                "examples": {
                  "processing_started": {
                    "summary": "Import processing started",
                    "value": {
                      "status": "processing_started",
                      "message": "File uploaded successfully. Processing started in background.",
                      "batch_id": "123e4567-e89b-12d3-a456-426614174000",
                      "filename": "stockx_sales_report.csv",
                      "record_count": 150,
                      "check_status_url": "/api/v1/integration/webhooks/import-status/123e4567-e89b-12d3-a456-426614174000"
                    }
                  },
                  "validation_only": {
                    "summary": "Validation only result",
                    "value": {
                      "status": "validated",
                      "valid": true,
                      "errors": [],
                      "warnings": ["Some items missing optional fields"],
                      "record_count": 150
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid file format or parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": {
                    "type": "validation_error",
                    "message": "Only CSV and Excel files are supported",
                    "details": {
                      "accepted_formats": [".csv", ".xlsx", ".xls"]
                    }
                  }
                }
              }
            }
          },
          "413": {
            "description": "File too large",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/integration/webhooks/notion/import": {
      "post": {
        "tags": ["Integration"],
        "summary": "Import Notion database data",
        "description": "Import inventory data from Notion database API response.",
        "operationId": "notion_import_webhook",
        "parameters": [
          {
            "name": "batch_size",
            "in": "query",
            "description": "Number of records to process in each batch",
            "schema": {
              "type": "integer",
              "default": 1000,
              "minimum": 1,
              "maximum": 10000
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "results": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "description": "Notion page ID"
                        },
                        "name": {
                          "type": "string",
                          "description": "Page title"
                        },
                        "properties": {
                          "type": "object",
                          "description": "Notion page properties"
                        }
                      }
                    }
                  },
                  "has_more": {
                    "type": "boolean",
                    "description": "Whether there are more results"
                  },
                  "next_cursor": {
                    "type": "string",
                    "nullable": true,
                    "description": "Cursor for next page of results"
                  }
                },
                "required": ["results"]
              },
              "example": {
                "results": [
                  {
                    "id": "page-123",
                    "name": "Nike Air Jordan 1",
                    "properties": {
                      "brand": {"rich_text": [{"text": {"content": "Nike"}}]},
                      "size": {"rich_text": [{"text": {"content": "US 9"}}]},
                      "purchase_price": {"number": 120.00},
                      "status": {"select": {"name": "In Stock"}}
                    }
                  }
                ],
                "has_more": false,
                "next_cursor": null
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Import completed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImportStatus"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid payload structure",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/integration/webhooks/manual/upload": {
      "post": {
        "tags": ["Integration"],
        "summary": "Manual file upload with auto-detection",
        "description": "Upload any supported file format with automatic source type detection.",
        "operationId": "manual_upload_webhook",
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "File to upload (CSV, Excel, JSON)"
                  },
                  "source_type": {
                    "type": "string",
                    "enum": ["auto", "stockx", "notion", "sales", "manual"],
                    "default": "auto",
                    "description": "Source type override, 'auto' for automatic detection"
                  },
                  "batch_size": {
                    "type": "integer",
                    "default": 1000,
                    "minimum": 1,
                    "maximum": 10000,
                    "description": "Number of records to process in each batch"
                  }
                },
                "required": ["file"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File uploaded successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImportStatus"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/integration/webhooks/import-status": {
      "get": {
        "tags": ["Integration"],
        "summary": "Get import status overview",
        "description": "Get summary of all import batches and recent activity.",
        "operationId": "get_import_status_overview",
        "responses": {
          "200": {
            "description": "Import status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImportBatchSummary"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/integration/webhooks/import-status/{batch_id}": {
      "get": {
        "tags": ["Integration"],
        "summary": "Get specific batch status",
        "description": "Get detailed status of a specific import batch.",
        "operationId": "get_batch_status",
        "parameters": [
          {
            "name": "batch_id",
            "in": "path",
            "required": true,
            "description": "Import batch ID",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Batch status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {"type": "string", "format": "uuid"},
                    "source_type": {"type": "string"},
                    "source_file": {"type": "string"},
                    "status": {"type": "string"},
                    "total_records": {"type": "integer"},
                    "processed_records": {"type": "integer"},
                    "error_records": {"type": "integer"},
                    "created_at": {"type": "string", "format": "date-time"},
                    "started_at": {"type": "string", "format": "date-time"},
                    "completed_at": {"type": "string", "format": "date-time", "nullable": true},
                    "processing_time_ms": {"type": "integer", "nullable": true}
                  }
                }
              }
            }
          },
          "404": {
            "description": "Batch not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": ["System"],
        "summary": "Health check",
        "description": "Check system health and dependencies.",
        "operationId": "health_check",
        "responses": {
          "200": {
            "description": "System is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {"type": "string", "example": "healthy"},
                    "timestamp": {"type": "string", "format": "date-time"},
                    "database": {"type": "string", "example": "connected"},
                    "version": {"type": "string", "example": "2.0.0"}
                  }
                }
              }
            }
          },
          "503": {
            "description": "System is unhealthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {"type": "string", "example": "unhealthy"},
                    "errors": {
                      "type": "array",
                      "items": {"type": "string"}
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ImportStatus": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["processing_started", "validated", "completed", "failed"],
            "description": "Current status of the import operation"
          },
          "batch_id": {
            "type": "string",
            "format": "uuid",
            "description": "Unique identifier for the import batch"
          },
          "message": {
            "type": "string",
            "description": "Human-readable status message"
          },
          "filename": {
            "type": "string",
            "description": "Original filename of uploaded file"
          },
          "record_count": {
            "type": "integer",
            "description": "Number of records processed"
          },
          "check_status_url": {
            "type": "string",
            "format": "uri",
            "description": "URL to check import progress"
          }
        },
        "required": ["status", "message"]
      },
      "ValidationResult": {
        "type": "object",
        "properties": {
          "valid": {
            "type": "boolean",
            "description": "Whether validation passed"
          },
          "errors": {
            "type": "array",
            "items": {"type": "string"},
            "description": "List of validation errors"
          },
          "warnings": {
            "type": "array",
            "items": {"type": "string"},
            "description": "List of validation warnings"
          },
          "record_count": {
            "type": "integer",
            "description": "Total number of records validated"
          }
        }
      },
      "ImportBatchSummary": {
        "type": "object",
        "properties": {
          "summary": {
            "type": "object",
            "properties": {
              "total_batches": {"type": "integer"},
              "completed": {"type": "integer"},
              "failed": {"type": "integer"},
              "processing": {"type": "integer"},
              "success_rate": {"type": "number", "format": "float"}
            }
          },
          "recent_imports": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {"type": "string", "format": "uuid"},
                "source_type": {"type": "string"},
                "source_file": {"type": "string"},
                "status": {"type": "string"},
                "created_at": {"type": "string", "format": "date-time"},
                "total_records": {"type": "integer"},
                "processed_records": {"type": "integer"}
              }
            }
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "description": "Error category"
              },
              "message": {
                "type": "string",
                "description": "Human-readable error message"
              },
              "details": {
                "type": "object",
                "description": "Additional error context"
              }
            },
            "required": ["type", "message"]
          }
        },
        "required": ["error"]
      }
    }
  },
  "tags": [
    {
      "name": "Integration",
      "description": "Data import and webhook endpoints"
    },
    {
      "name": "StockX Integration",
      "description": "Endpoints specifically for StockX data import and management."
    },
    {
      "name": "System",
      "description": "System health and monitoring"
    }
  ]
}